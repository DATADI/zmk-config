#include <behaviors.dtsi>
#include <dt-bindings/zmk/keys.h>
#include <dt-bindings/zmk/bt.h>
#include <dt-bindings/zmk/pointing.h>

/ {
    mid_encoder: mid_encoder { 
        compatible = "alps,ec11";
        status = "okay";
        /* ä½ çš„å¼•è„šå®šä¹‰ (ä¿æŒä¸å˜) */
        a-gpios = <&gpio0 31 (GPIO_ACTIVE_HIGH | GPIO_PULL_UP)>;
        b-gpios = <&gpio0 29 (GPIO_ACTIVE_HIGH | GPIO_PULL_UP)>;
        steps = <24>;
    };

    sensors {
        compatible = "zmk,keymap-sensors";
        sensors = <&mid_encoder>;
        triggers-per-rotation = <20>;
    };

    kscan0: kscan_0 {
        compatible = "zmk,kscan-gpio-direct";
        input-gpios = <&gpio0 20 (GPIO_ACTIVE_LOW | GPIO_PULL_UP)>;
    };

    chosen {
        zmk,kscan = &kscan0;
    };

    behaviors {
        scroll_encoder: scroll_encoder {
            compatible = "zmk,behavior-sensor-rotate";
            #sensor-binding-cells = <0>;
            bindings = <&msc SCRL_DOWN>, <&msc SCRL_UP>;
            tap-ms = <30>; 
        };

        /* * ğŸ® å¤šå‡»é€»è¾‘æ ¸å¿ƒ (Tap Dance)
         * ---------------------------
         * 1 å‡»: å·¦é”®ç‚¹å‡» (&mkp LCLK) - å¦‚æœä½ æƒ³ç”¨æ’­æ”¾æš‚åœï¼Œæ”¹æˆ &kp C_PP
         * 2 å‡»: åˆ‡æ¢ä¸‹ä¸€ä¸ªè“ç‰™è®¾å¤‡ (&bt BT_NXT)
         * 3 å‡»: æ— åŠ¨ä½œ (&none) - é˜²æ­¢è¯¯è§¦
         * 4 å‡»: æ— åŠ¨ä½œ (&none)
         * 5 å‡»: æ¸…ç©ºå½“å‰è“ç‰™ (&bt BT_CLR)
         */
        td_multi: tap_dance_actions {
            compatible = "zmk,behavior-tap-dance";
            #binding-cells = <0>;
            tapping-term-ms = <400>; /* åˆ¤å®šæ—¶é—´ 400msï¼Œæ‰‹æ…¢ä¹Ÿèƒ½è§¦å‘ */
            bindings = <&mkp LCLK>, <&bt BT_NXT>, <&none>, <&none>, <&bt BT_CLR>;
        };
    };

    keymap {
        compatible = "zmk,keymap";
        default_layer {
            bindings = < &td_multi >;
            sensor-bindings = <&scroll_encoder>;
        };
    };
};
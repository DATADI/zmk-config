#include <behaviors.dtsi>
#include <dt-bindings/zmk/keys.h>
#include <dt-bindings/zmk/bt.h>
#include <dt-bindings/zmk/pointing.h>
#include <dt-bindings/zmk/outputs.h>

/ {
    /* * ğŸ® æ—‹é’® (Encoder)
     * Nice!Nano ä¸å°æ ‡è¯†å¯¹ç…§ï¼š
     * Açº¿ -> 031 (å³ A3) -> å¯¹åº” Pro Micro å¼•è„š 20
     * Bçº¿ -> 029 (å³ A2) -> å¯¹åº” Pro Micro å¼•è„š 19
     */
    mid_encoder: mid_encoder { 
        compatible = "alps,ec11";
        status = "okay";
        a-gpios = <&pro_micro 21 (GPIO_ACTIVE_HIGH | GPIO_PULL_UP)>;
        b-gpios = <&pro_micro 20 (GPIO_ACTIVE_HIGH | GPIO_PULL_UP)>;
        steps = <24>;
    };

    sensors {
        compatible = "zmk,keymap-sensors";
        sensors = <&mid_encoder>;
        triggers-per-rotation = <20>;
    };

    /* * ğŸ”˜ æŒ‰é’® (Button)
     * Nice!Nano ä¸å°æ ‡è¯†å¯¹ç…§ï¼š
     * SWçº¿ -> 020 (å³ D3) -> å¯¹åº” Pro Micro å¼•è„š 5
     */
    kscan0: kscan_0 {
        compatible = "zmk,kscan-gpio-direct";
        input-gpios = <&pro_micro 3 (GPIO_ACTIVE_LOW | GPIO_PULL_UP)>;
    };

    chosen {
        zmk,kscan = &kscan0;
    };

    behaviors {
        /* ğŸ”„ ç¿»é¡µé€»è¾‘ï¼šé¡ºæ—¶é’ˆ=PageDown, é€†æ—¶é’ˆ=PageUp */
        page_encoder: page_encoder {
            compatible = "zmk,behavior-sensor-rotate";
            #sensor-binding-cells = <0>;
            bindings = <&kp PG_DN>, <&kp PG_UP>;
            tap-ms = <30>; 
        };

        /* ğŸ–±ï¸ å¤šåŠŸèƒ½ç‚¹å‡»ï¼š1å‡»=å·¦é”®, 2å‡»=åˆ‡è“ç‰™, 3å‡»=åˆ‡USB/BLE, 5å‡»=é‡ç½® */
        td_multi: tap_dance_actions {
            compatible = "zmk,behavior-tap-dance";
            #binding-cells = <0>;
            tapping-term-ms = <400>;
            bindings = <&mkp LCLK>, <&bt BT_NXT>, <&out OUT_TOG>, <&none>, <&bt BT_CLR>;
        };
    };

    keymap {
        compatible = "zmk,keymap";
        default_layer {
            bindings = < &td_multi >;
            sensor-bindings = <&page_encoder>;
        };
    };
};
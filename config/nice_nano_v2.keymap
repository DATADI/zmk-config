/*
 * Copyright (c) 2020 The ZMK Contributors
 * SPDX-License-Identifier: MIT
 */

#include <behaviors.dtsi>
#include <dt-bindings/zmk/keys.h>
#include <dt-bindings/zmk/bt.h>
#include <dt-bindings/zmk/pointing.h>
/* ğŸŸ¢ æ–°å¢ï¼šå¼•å…¥è¾“å‡ºæ§åˆ¶å¤´æ–‡ä»¶ */
#include <dt-bindings/zmk/outputs.h>

/ {
    /* ==============================================
     * 1. ç¡¬ä»¶å¼•è„šçº¦å®š (ä¿æŒä¸å˜)
     * ============================================== */
    mid_encoder: mid_encoder { 
        compatible = "alps,ec11";
        status = "okay";
        a-gpios = <&gpio0 31 (GPIO_ACTIVE_HIGH | GPIO_PULL_UP)>;
        b-gpios = <&gpio0 29 (GPIO_ACTIVE_HIGH | GPIO_PULL_UP)>;
        steps = <80>;
    };

    sensors {
        compatible = "zmk,keymap-sensors";
        sensors = <&mid_encoder>;
        triggers-per-rotation = <20>;
    };

    kscan0: kscan_0 {
        compatible = "zmk,kscan-gpio-direct";
        input-gpios = <&gpio0 20 (GPIO_ACTIVE_LOW | GPIO_PULL_UP)>;
    };

    chosen {
        zmk,kscan = &kscan0;
    };

    /* ==============================================
     * 2. è¡Œä¸ºå®šä¹‰ (Behaviors)
     * ============================================== */
    behaviors {
        /* è‡ªå®šä¹‰æ»šè½® (ä¿æŒä¸å˜) */
        scroll_encoder: scroll_encoder {
            compatible = "zmk,behavior-sensor-rotate";
            #sensor-binding-cells = <0>;
            bindings = <&msc SCRL_DOWN>, <&msc SCRL_UP>;
            tap-ms = <30>; 
        };

        /* ğŸŸ¢ ä¿®æ”¹ï¼šTap Dance (å¤šé‡ç‚¹å‡»é€»è¾‘) */
        td_multi: tap_dance_actions {
            compatible = "zmk,behavior-tap-dance";
            #binding-cells = <0>;
            tapping-term-ms = <300>;
            bindings = <&kp C_PP>,       /* 1å‡»: æ’­æ”¾/æš‚åœ */
                       <&none>,           /* 2å‡»: æ— åŠ¨ä½œ */
                       <&out OUT_TOG>,    /* 3å‡»: ğŸŸ¢ åˆ‡æ¢ USB/è“ç‰™ è¾“å‡º */
                       <&none>,           /* 4å‡»: æ— åŠ¨ä½œ */
                       <&bt BT_CLR>;      /* 5å‡»: æ¸…é™¤è“ç‰™ */
        };
    };

    /* ==============================================
     * 3. æŒ‰é”®æ˜ å°„å±‚
     * ============================================== */
    keymap {
        compatible = "zmk,keymap";

        default_layer {
            /* ç»‘å®šæ–°çš„å¤šé‡ç‚¹å‡»è¡Œä¸º */
            bindings = < &td_multi >;
            sensor-bindings = <&scroll_encoder>;
        };
    };
};
#include <behaviors.dtsi>
#include <dt-bindings/zmk/keys.h>
#include <dt-bindings/zmk/bt.h>
#include <dt-bindings/zmk/outputs.h>
/* âš ï¸ å¿…é¡»å¼•å…¥é¼ æ ‡å¤´æ–‡ä»¶ï¼Œå¦åˆ™ &msc ä¼šæŠ¥é”™ */
#define ZMK_POINTING_DEFAULT_MOVE_VAL 1500  // default: 600
#define ZMK_POINTING_DEFAULT_SCRL_VAL 250    // default: 10
#include <dt-bindings/zmk/pointing.h>

/ {
    /* ç¡¬ä»¶å®šä¹‰ (ä¿æŒä½ çš„ Nice!Nano/Supermini å¼•è„šè®¾ç½®) */
    mid_encoder: mid_encoder { 
        compatible = "alps,ec11";
        status = "okay";
        a-gpios = <&pro_micro 4 (GPIO_ACTIVE_HIGH | GPIO_PULL_UP)>;
        b-gpios = <&pro_micro 5 (GPIO_ACTIVE_HIGH | GPIO_PULL_UP)>;
        /* å¦‚æœè½¬åŠ¨ä¸çµæ•ï¼Œå°è¯•æ”¹ä¸º 48 æˆ– 80 */
        steps = <24>; 
    };

    sensors {
        compatible = "zmk,keymap-sensors";
        sensors = <&mid_encoder>;
        triggers-per-rotation = <24>;
    };

    kscan0: kscan_0 {
        compatible = "zmk,kscan-gpio-direct";
        input-gpios = <&pro_micro 21 (GPIO_ACTIVE_LOW | GPIO_PULL_UP)>;
    };

    chosen {
        zmk,kscan = &kscan0;
    };

    behaviors {
        /* * ğŸ–±ï¸ é¼ æ ‡æ»šè½®é€»è¾‘ (Scroll Encoder)
         * ------------------------------------------------
         * &msc SCRL_DOWN : æ¨¡æ‹Ÿé¼ æ ‡æ»šè½®å‘åæ»š (é€šå¸¸æ˜¯ç½‘é¡µå‘ä¸‹ç¿»)
         * &msc SCRL_UP   : æ¨¡æ‹Ÿé¼ æ ‡æ»šè½®å‘å‰æ»š (é€šå¸¸æ˜¯ç½‘é¡µå‘ä¸Šç¿»)
         */
        scroll_encoder: scroll_encoder {
            compatible = "zmk,behavior-sensor-rotate";
            #sensor-binding-cells = <0>;
            /* * å¦‚æœæ–¹å‘åäº† (é¡ºæ—¶é’ˆå˜æˆäº†ä¸Šæ»š)ï¼Œ
             * è¯·å°†ä¸‹é¢ä¸¤ä¸ªæŒ‡ä»¤äº’æ¢ä½ç½®ï¼š <&msc SCRL_UP>, <&msc SCRL_DOWN>
             */
            bindings = <&msc SCRL_DOWN>, <&msc SCRL_UP>;
            tap-ms = <30>; 
        };

        /* æŒ‰é’®é€»è¾‘ (ä¿ç•™ä¹‹å‰çš„å¤šåŠŸèƒ½è®¾ç½®) */
        td_multi: tap_dance_actions {
            compatible = "zmk,behavior-tap-dance";
            #binding-cells = <0>;
            tapping-term-ms = <400>;
            bindings = <&mkp LCLK>, <&bt BT_NXT>, <&out OUT_TOG>, <&none>, <&bt BT_CLR>;
        };
    };

    keymap {
        compatible = "zmk,keymap";
        default_layer {
            bindings = < &td_multi >;
            /* è¿™é‡Œç»‘å®šåˆšæ‰å®šä¹‰çš„æ»šè½®è¡Œä¸º */
            sensor-bindings = <&scroll_encoder>;
        };
    };
};